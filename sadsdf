import requests
from bs4 import BeautifulSoup
import json
from datetime import datetime

URL = "https://www.bbc.com/sport/football/premier-league/scores-fixtures"

headers = {"User-Agent": "Mozilla/5.0"}

def parse_date(date_str):
    try:
        dt = datetime.strptime(date_str.strip(), "%A %d %B %Y")
        return dt.strftime("%Y-%m-%d")
    except:
        return None

print("Downloading fixtures from BBC Sport...")
res = requests.get(URL, headers=headers)
soup = BeautifulSoup(res.text, "lxml")

matches = []
current_date = None

for section in soup.select("div.qa-match-block"):
    date_header = section.find_previous("h3")
    if date_header:
        parsed = parse_date(date_header.text)
        if parsed:
            current_date = parsed

    home = section.select_one("span.qa-home-team-name")
    away = section.select_one("span.qa-away-team-name")
    score = section.select_one("span.qa-full-time-score")

    if not home or not away or not current_date:
        continue

    matches.append({
        "date": current_date,
        "time": "",
        "home": home.text.strip(),
        "away": away.text.strip(),
        "score": score.text.strip() if score else ""
    })

# Split into matchdays (10 games each)
matchdays = []
for i in range(0, len(matches), 10):
    matchdays.append({
        "matchday": (i // 10) + 1,
        "matches": matches[i:i+10]
    })

schedule = {
    "competition": "Premier League",
    "season": "2025/2026",
    "matchdays": matchdays
}

with open("schedule.json", "w") as f:
    json.dump(schedule, f, indent=2)

print(f"âœ… Created schedule.json with {len(matches)} matches")

