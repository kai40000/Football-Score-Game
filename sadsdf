import requests
from bs4 import BeautifulSoup
import json
from datetime import datetime

URL = "https://int.soccerway.com/national/england/premier-league/20252026/regular-season/r81364/matches/"

headers = {"User-Agent": "Mozilla/5.0"}

def format_date(date_str):
    try:
        dt = datetime.strptime(date_str.strip(), "%d/%m/%y")
        return dt.strftime("%Y-%m-%d")
    except:
        return None

print("Downloading data from Soccerway...")
res = requests.get(URL, headers=headers)
soup = BeautifulSoup(res.text, "lxml")

matches = []

for row in soup.select("table.matches tbody tr"):
    date_cell = row.select_one("td.full-date")
    home_cell = row.select_one("td.team-a")
    away_cell = row.select_one("td.team-b")
    score_cell = row.select_one("td.score-time")

    if not date_cell or not home_cell or not away_cell:
        continue

    date = format_date(date_cell.text)
    home = home_cell.text.strip()
    away = away_cell.text.strip()
    score = score_cell.text.strip() if score_cell else ""

    if not date:
        continue

    matches.append({
        "date": date,
        "time": "",
        "home": home,
        "away": away,
        "score": score
    })

# Split into matchdays of 10 games each
matchdays = []
for i in range(0, len(matches), 10):
    matchdays.append({
        "matchday": (i // 10) + 1,
        "matches": matches[i:i+10]
    })

schedule = {
    "competition": "Premier League",
    "season": "2025/2026",
    "matchdays": matchdays
}

with open("schedule.json", "w") as f:
    json.dump(schedule, f, indent=2)

print("âœ… schedule.json created!")
