from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from bs4 import BeautifulSoup
from datetime import datetime
import json
import time

URL = "https://www.worldfootball.net/all_matches/eng-premier-league-2025-2026/"

options = Options()
options.add_argument("--headless")
options.add_argument("--no-sandbox")
options.add_argument("--disable-dev-shm-usage")

service = Service("/usr/bin/chromedriver")
driver = webdriver.Chrome(service=service, options=options)

driver.get(URL)
time.sleep(5)

html = driver.page_source
driver.quit()

soup = BeautifulSoup(html, "lxml")

schedule = {
    "competition": "Premier League",
    "season": "2025/2026",
    "matchdays": []
}

current_md = None
matchdays = {}

for row in soup.select("table.standard_tabelle tr"):
    cells = row.find_all("td")

    if len(cells) == 1:
        text = cells[0].get_text(strip=True)
        if text.startswith("Matchday"):
            current_md = int(text.split()[-1])
            matchdays[current_md] = []
        continue

    if len(cells) >= 6 and current_md:
        date = cells[0].get_text(strip=True)
        home = cells[2].get_text(strip=True)
        away = cells[4].get_text(strip=True)
        score = cells[5].get_text(strip=True)

        try:
            date_iso = datetime.strptime(date, "%d/%m/%Y").strftime("%Y-%m-%d")
        except:
            continue

        matchdays[current_md].append({
            "date": date_iso,
            "time": None,
            "home": home,
            "away": away,
            "score": None if score == "-" else score
        })

for md in sorted(matchdays):
    schedule["matchdays"].append({
        "matchday": md,
        "matches": matchdays[md]
    })

with open("schedule.json", "w") as f:
    json.dump(schedule, f, indent=2)

print("schedule.json created successfully")
